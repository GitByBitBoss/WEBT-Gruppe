<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>DriveWell API Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f7fa; color:#222; margin:40px; }
    h1 { text-align:center; color:#2c3e50; }
    #output { background:#fff; border-radius:10px; box-shadow:0 0 8px rgba(0,0,0,0.1); margin:20px auto; padding:20px 30px; max-width:800px; }
    .question { background:#f9f9ff; margin:10px 0; padding:10px 15px; border-radius:6px; }
    .question h3 { margin:0 0 6px; font-size:16px; }
    .correct { color:#2ecc71; font-weight:bold; }
    .muted { color:#666; font-size:14px; }
    .error { color:#c0392b; font-weight:bold; }
  </style>
</head>
<body>
  <h1>Theoriefragen API Demo</h1>
  <div id="output">Lade Daten…</div>

  <script type="module">
    const output = document.getElementById("output");

    // Nutze relative URL (vermeidet Port/Origin-Probleme, solange gleiche Domain)
    const API_URL = "/getCourse.php?id=1";

    async function getData() {
      try {
        const response = await fetch(API_URL, { headers: { "Accept": "application/json" } });
        if (!response.ok) {
          throw new Error(`Response status: ${response.status}`);
        }
        return await response.json();
      } catch (err) {
        console.error(err);
        return { error: true, message: String(err?.message || err) };
      }
    }

    function renderCourse(course) {
      // Header
      const header = document.createElement("div");
      const h2 = document.createElement("h2");
      const meta = document.createElement("div");
      meta.className = "muted";

      h2.textContent = `${course?.name ?? "Unbekannter Kurs"}${course?.vehicleType ? " (" + course.vehicleType + ")" : ""}`;
      meta.textContent = `${Array.isArray(course?.questions) ? course.questions.length : 0} Fragen`;

      header.appendChild(h2);
      header.appendChild(meta);
      output.appendChild(header);

      // Fragenliste
      if (!Array.isArray(course?.questions) || course.questions.length === 0) {
        const p = document.createElement("p");
        p.className = "muted";
        p.textContent = "Für diesen Kurs sind keine Fragen vorhanden.";
        output.appendChild(p);
        return;
      }

      course.questions.forEach((q, idx) => {
        const qDiv = document.createElement("div");
        qDiv.className = "question";

        // Titel
        const title = document.createElement("h3");
        title.textContent = `#${idx + 1} ${q?.text ?? "Ohne Titel"}`;
        qDiv.appendChild(title);

        // Optionen
        if (Array.isArray(q?.options) && q.options.length) {
          const ul = document.createElement("ul");
          q.options.forEach(opt => {
            const li = document.createElement("li");
            li.textContent = opt; // sicher, kein innerHTML
            if (q?.correctAnswer != null && opt === q.correctAnswer) {
              li.classList.add("correct");
            }
            ul.appendChild(li);
          });
          qDiv.appendChild(ul);
        }

        // Korrekte Antwort (falls noch einmal explizit gezeigt werden soll)
        // Optional – auskommentiert lassen, wenn nicht doppelt benötigt:
        // if (q?.correctAnswer != null) {
        //   const ans = document.createElement("div");
        //   ans.className = "muted";
        //   ans.textContent = `Richtige Antwort: ${q.correctAnswer}`;
        //   qDiv.appendChild(ans);
        // }

        output.appendChild(qDiv);
      });
    }

    // Start
    const course = await getData();
    output.textContent = ""; // reset

    if (course?.error) {
      const e = document.createElement("div");
      e.className = "error";
      e.textContent = `Fehler beim Laden der Daten: ${course.message}`;
      output.appendChild(e);
    } else {
      // Erwartete Form: { name, vehicleType, questions: [{ text, options:[], correctAnswer }] }
      renderCourse(course);
    }
  </script>
</body>
</html>
